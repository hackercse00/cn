//DEAD LOCK DETECTION
#include<stdio.h>
int p,r;
int safe(int[p][r],int[p][r],int[],int[]);
void print(int[p][r],int[p][r],int[],int[]);
void main(){
    printf("Enter the number of processes : ");
    scanf("%d",&p);
    printf("Enter the number of resources : ");
    scanf("%d",&r);
    int alloc[p][r],req[p][r],avail[r],name[p],i,j,s,total[r];
    for(i=0;i<r;i++){
        printf("Enter the number of total resources of r[%d] : ",i);
        scanf("%d",&total[i]);
        avail[i]=0;
    }
    for(i=0;i<p;i++){
        printf("Enter the process name : ");
        scanf("%d",&name[i]);
        for(j=0;j<r;j++){
            printf("Enter the number of resources of r[%d] : ",j);
            scanf("%d",&alloc[i][j]);
            printf("Enter the request of resources of r[%d] : ",j);
            scanf("%d",&req[i][j]);
            avail[j]=avail[j]+alloc[i][j];
        }
    }
    for(j=0;j<r;j++){
        avail[j]=total[j]-avail[j];
    }
    printf("\n");
    print(alloc,req,avail,name);
    safe(alloc,req,avail,name);
}
int safe(int alloc[p][r],int req[p][r],int avail[r],int name[p]){
    int i,j,work[r],finish[p],saf[p],flag=0,count=p,k=0,s,f=0;
    for(i=0;i<r;i++){
        work[i]=avail[i];
    }
    for(i=0;i<p;i++){
     f=0;
        finish[i]=0;
        for(j=0;j<r;j++){
         if(alloc[i][j]==0){
          f++;
         }
       }
       if(f==r){
           finish[i]=1;
        }
    }
  l:while(count>0){
        s=0;
        for(i=0;i<p;i++){
            flag=0;
            if(finish[i]!=1){
                for(j=0;j<r;j++){
                    if(req[i][j]<=work[j]){
                        flag++;
                    }
                }
                if(flag==r){
                    for(j=0;j<r;j++){
                        work[j]=work[j]+alloc[i][j];
                    }
                    finish[i]=1;
                    s=1;
                    count--;
                    saf[k]=i;
                    k++;
                    goto l;
                }
            }
        }
        if(s==0){
         printf("\n\tNOT SAFE\n");
            return;
        }
    }
    for(i=0;i<p;i++){
        if(finish[i]==0){
         printf("\n\tNOT SAFE\n");
            return;
  }
 }
    printf("\n SAFE \nSafe sequence : ");
    for(i=0;i<p;i++){
  printf("p%d\t",saf[i]);
    }
}
void print(int alloc[p][r],int req[p][r],int avail[r],int name[p]){
       int i,j;
       printf("\nAvailable :\t");
       for(i=0;i<r;i++){
           printf("%d\t",avail[i]);
       }
       printf("\npname\talloc\treq\t");
       for(i=0;i<p;i++){
                    printf("\np[%d]\t",name[i]);
                for(j=0;j<r;j++){
                        printf("%d ",alloc[i][j]);
                }
                printf("\t");
                for(j=0;j<r;j++){
                        printf("%d ",req[i][j]);
                }
       }
}
