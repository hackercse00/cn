//MVT
#include<stdio.h>
void main(){
        int m,n,s,os,i,j,k,tq,h=0,temp,time=0,min,ef=0;
        printf("Enter the memory size : ");
        scanf("%d",&m); 
        printf("Enter the memory for OS : ");
        scanf("%d",&os);
        s=m-os;
        printf("The memory is : %d\n",s);
        printf("Enter the total time quantum: ");
        scanf("%d",&tq);
        printf("Enter the number of process : ");
        scanf("%d",&n);
        int a[n],bt[n],alloc[n],p[n][2],b[n][2];
        for(i=0;i<n;i++){
                printf("Enter the memory required for the process %d : ",i+1);
                scanf("%d",&a[i]);
                printf("Enter the burst time : ");
                scanf("%d",&bt[i]);
                alloc[i]=0;
        }
        for(i=0;i<n;i++){
            if(a[i]<=s){
                p[i][0]=m-s;
                s=s-a[i];
                p[i][1]=m-s;
                alloc[i]=1;
            }
        }
                if(s!=0){
                    b[0][0]=m-s;
                    b[0][1]=m;
                    h++;
                }
        l:while(time<=tq){
                temp=0,min=1000;
                for(i=0;i<n;i++){
                        if(alloc[i]==1 && bt[i]<min && bt[i]<=tq-time){
                                min=bt[i];
                                k=i;
                                temp=1;
                        }
                }
                if(temp==0){
                        break;
                }
                time=time+min;
                alloc[k]=2;
                b[h][0]=p[k][0];
                b[h++][1]=p[k][1];
              k:for(i=0;i<h;i++){
                        for(j=0;j<h;j++){
                                if(b[i][1]==b[j][0] && i!=j && b[i][1]!=0){
                                        b[i][1]=b[j][1];
                                        b[j][0]=b[j][1]=0;
                                        goto k;
                                }
                        }
                }
                for(i=0;i<h;i++){
                        if(b[i][0]==b[i][1]){
                                for(j=i+1;j<h;j++){
                                        b[j-1][0]=b[j][0];
                                        b[j-1][1]=b[j][1];
                                }
                                h--;
                        }
                }
                for(i=0;i<n;i++){
                        if(alloc[i]==0){
                           temp=0;
                                for(j=0;j<h;j++){
                                        if(b[j][1]-b[j][0]>=a[i]){
                                                p[i][0]=b[j][0];
                                                p[i][1]=p[i][0]+a[i];
                                                if(b[j][1]-b[j][0]==a[i]){
                                                b[j][0]=b[j][i]=0;
}
else{
   b[j][0]=p[i][1];
}
                                                alloc[i]=1;
                                                temp=1;
                                                goto k;
                                        }
                                }
                                if(temp==0){
                                   goto l;
       }
                        }
                }
        }
        for(i=0;i<h;i++){
                printf("HOLE %d is from %d to %d\n",i+1,b[i][0],b[i][1]);
                ef=ef+b[i][1]-b[i][0];
        }
        printf("Process\tMemory req\t BT\tMemory alloc/not\n");
        for(i=0;i<n;i++){
                printf("  %d\t  %d\t\t  %d\t",i+1,a[i],bt[i]);
                if(alloc[i]==0){
                        printf("  Memory not allocated\n");
                }
                else if(alloc[i]==1){
                        printf("  Memory allocated & process still going(%d-%d)\n",p[i][0],p[i][1]);
                }
                else if(alloc[i]==2){
                        printf("  Memory allocated & process completed(%d-%d)\n",p[i][0],p[i][1]);
                }
        }
        printf("\nThe EXTERNAL FRAGMENTATION is %d\n",ef);
}
